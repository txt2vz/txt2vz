<!DOCTYPE html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='icon' href='favicon.ico' type='image/x-icon'/>
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/t2v.css">

</head>
<title>boa</title>

<body>
<div class="container  col-md-12">

    <button type="button" class="btn btn-info" data-toggle="collapse"
            data-target="#control2">Show/Hide controls/selections
    </button>
    <div id="control2" class="collapse in well">

        <div class="row">

            <div class="col-md-3">
                <br>
                Select Visualisation Type: <select id="networkType">
                <option value="radial">Radial</option>
                <option value="partition">Partition</option>
                <option value="forceNetwork">Network</option>
            </select> <br/> <br/>

             <span id="hint">
                 Mouse wheel to zoom. <br/> Hold click and move mouse to move tree
              </span>
            </div>
            <div>
                <span id = "choose">Select a valid JSON file: </span> <input type="file" onchange="processJSONfile()">
            </div>
        </div>
    </div>
    <div class="row col-md-12">
        <div class="main"></div>
        <div id="vis"></div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="js/drawForceTree.js"></script>
<script src="js/drawDendrogram.js"></script>
<script src="js/drawForceNetwork.js"></script>
<script src="js/drawRadial.js"></script>
<script src="js/colorbrewer.js"></script>
<script src="js/frontPage.js"></script>
<script src="js/frontPage2.js"></script>
<script src="js/artai.js"></script>
<script src="js/partitionD.js"></script>
<script src="js/d3.chart.min.js"></script>
<script src="js/d3.chart.layout.hierarchy.js"></script>
<script src="https://d3js.org/d3-hierarchy.v1.min.js"></script>

<script>
    frontPage();

    function processJSONfile(upload) {

        var file = document.querySelector('input[type=file]').files[0];
        var reader = new FileReader()

        var jsonFile = 'application/json';
        if (file.type.match(jsonFile)) {

            reader.onload = function (event) {

                var j = JSON.parse(event.target.result);
                var visType = $("#networkType").val();

                switch (visType) {
                    case 'forceTree':
                        drawForceTree(j);
                        break;

                    case 'radial':
                        radial(j);
                        break;

                    case 'forceNetwork':
                        drawForceNetwork(j);
                        break;

                    case 'partition':
                        drawPartition(j)
                        break;

                    case 'dendro':
                        drawDendrogram(j)
                        break;
                }
            }
        }
        reader.readAsText(file);
    }
</script>

<script>
    //http://bl.ocks.org/bansaghi/f3cbb5e7b759b6a58aff
    //radial zoomable collapsible
    function radial(json) {
        console.log("jsonText in radial " + json);
        var ar = new Array();

        var promise0 = new Promise(function (resolve, reject) {

            d3.hierarchy(json, function (d) {
                ar.push(d.cooc);
                return d.children;
            });

            resolve(d3.extent(ar));

        });

        promise0.then(function (value) {

            var linearScale = d3.scale.linear()
                .domain(value)
                .range([2, 7]);

            d3.select("svg").remove();
            var tree = d3.select("#vis").append("svg")

                .chart("tree.radial")   //.diameter(500)
                .radius(//4)
                    function (d) {
                        var nodeSize = linearScale(d.cooc);
                        // console.log("node size " + nodeSize + " cooc " + d.cooc);
                        return nodeSize;
                    })

                .levelGap(100).zoomable([0.1, 3]).collapsible(7);     //.duration(200)   //.sortable("_ASC_")
            tree.draw(json);
        });
    }

    function drawPartition(json) {

        d3.select("svg").remove();

        var partition = d3.select("#vis").append("svg")

            .chart("partition.rectangle")
            .value("cooc")
            .zoomable([0.5, 5])
            .collapsible()
            //.duration(200)
            .sortable("_DESC_");

        partition.draw(json);
    }

    $(document).ready(function () {
        $("#hint").show();

        $("select#networkType")
            .on('change', function () {

                if (($("#networkType").val() == "forceNetwork")) {
                    $("#hint").hide();
                } else {
                    $("#hint").show();
                }
            });
    });

</script>

</body>
</html>